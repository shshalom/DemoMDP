{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mdp.dev/schemas/policy-card/v1",
  "title": "PolicyCard",
  "description": "A compiled policy card defining rules, constraints, and violation handlers",
  "type": "object",
  "required": ["id", "version", "scope", "role", "hash"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique policy identifier (e.g., 'eng.pr.review', 'ui.design.tokens')",
      "pattern": "^[a-z][a-z0-9-]*(?:\\.[a-z][a-z0-9-]*)+$"
    },
    "version": {
      "type": "string",
      "description": "Semantic version or date-based version (YYYY.MM.DD)",
      "pattern": "^(\\d{4}\\.\\d{2}\\.\\d{2}|\\d+\\.\\d+\\.\\d+(?:-[a-zA-Z0-9.-]+)?)$"
    },
    "scope": {
      "type": "string",
      "description": "Scope where policy applies (e.g., 'repo', 'org', 'global')",
      "enum": ["repo", "org", "team", "global"]
    },
    "role": {
      "type": "string",
      "description": "Role or phase where policy is active (e.g., 'pr', 'feature', 'issue')",
      "pattern": "^[a-z][a-z0-9._-]*$"
    },
    "title": {
      "type": "string",
      "description": "Human-readable policy title"
    },
    "description": {
      "type": "string",
      "description": "Detailed policy description"
    },
    "tags": {
      "type": "array",
      "description": "Tags for filtering and grouping policies",
      "items": {
        "type": "string"
      }
    },
    "constraints": {
      "type": "object",
      "description": "Validation rules and requirements",
      "additionalProperties": true
    },
    "on_violation": {
      "type": "array",
      "description": "Actions to take when policy is violated",
      "items": {
        "type": "object",
        "required": ["action"],
        "properties": {
          "action": {
            "type": "string",
            "enum": ["warn", "fail", "comment", "suggest_patch", "notify"]
          },
          "message": {
            "type": "string",
            "description": "Template message for the violation"
          },
          "metadata": {
            "type": "object",
            "description": "Additional action-specific metadata",
            "additionalProperties": true
          }
        }
      }
    },
    "hash": {
      "type": "string",
      "description": "Content hash (SHA-256) of the policy for integrity verification",
      "pattern": "^sha256:[a-f0-9]{64}$"
    },
    "signature": {
      "type": "string",
      "description": "Ed25519 signature for authenticity verification"
    },
    "signed_by": {
      "type": "string",
      "description": "Public key fingerprint of signer"
    },
    "aoi": {
      "type": "object",
      "description": "Architecture of Intent (AOI) configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether AOI is enabled for this policy"
        },
        "framework": {
          "type": "string",
          "description": "Target framework repository (e.g., github.com/company/framework)"
        },
        "owners": {
          "type": "array",
          "description": "Assigned owners for AOI specs",
          "items": {
            "type": "string"
          }
        },
        "include_tests": {
          "type": "boolean",
          "description": "Include tests in counter-PR",
          "default": false
        },
        "threshold": {
          "type": "number",
          "description": "Vector similarity threshold (0.0-1.0)",
          "minimum": 0.0,
          "maximum": 1.0,
          "default": 0.8
        },
        "auto_create_counter_pr": {
          "type": "boolean",
          "description": "Automatically create counter-PR without approval",
          "default": false
        },
        "auto_create_followup_pr": {
          "type": "boolean",
          "description": "Automatically create follow-up PR without approval",
          "default": false
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional policy metadata",
      "properties": {
        "author": {
          "type": "string"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "source": {
          "type": "string",
          "description": "Path to source Markdown file"
        }
      },
      "additionalProperties": true
    }
  }
}
