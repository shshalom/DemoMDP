/**
 * PR Comment Templates (M5 - Team B)
 *
 * Render PR comments with evidence and policy violation context.
 * Templates follow Step 11 spec for consolidated comments.
 */
// ============================================================================
// TEMPLATE RENDERERS
// ============================================================================
/**
 * Render a PR comment template
 */
export function renderCommentTemplate(templateName, context) {
    switch (templateName) {
        case 'suggest-patch':
            return renderSuggestPatchTemplate(context);
        case 'notification':
            return renderNotificationTemplate(context);
        case 'violation':
            return renderViolationTemplate(context);
        default:
            throw new Error(`Unknown template: ${templateName}`);
    }
}
/**
 * Suggest Patch Template
 */
function renderSuggestPatchTemplate(context) {
    const { policy, violations = [], patch, evidence = [] } = context;
    let comment = '## MDP Policy Suggestion\n\n';
    // Policy info
    if (policy) {
        comment += `**Policy:** ${policy.title || policy.id}\n`;
        comment += `**Version:** ${policy.version}\n\n`;
        if (policy.description) {
            comment += `${policy.description}\n\n`;
        }
    }
    // Violations
    if (violations.length > 0) {
        comment += '### Issues Found\n\n';
        violations.forEach((v, i) => {
            const severity = v.severity || 'warning';
            const emoji = severity === 'error' ? ':x:' : ':warning:';
            comment += `${emoji} **${v.message || 'Policy violation'}**\n`;
            if (v.location?.file) {
                comment += `   - File: \`${v.location.file}\``;
                if (v.location.line) {
                    comment += `:${v.location.line}`;
                }
                comment += '\n';
            }
        });
        comment += '\n';
    }
    // Suggested patch
    if (patch) {
        comment += '### Suggested Fix\n\n';
        comment += '```diff\n';
        comment += patch;
        comment += '\n```\n\n';
    }
    // Evidence
    if (evidence.length > 0) {
        comment += '### Evidence\n\n';
        evidence.forEach((e) => {
            comment += `- ${e}\n`;
        });
        comment += '\n';
    }
    // Footer
    comment += '---\n';
    comment += '*This suggestion was generated by MDP Policy Engine. ';
    comment += 'Review the changes and apply if appropriate.*\n';
    return comment;
}
/**
 * Notification Template
 */
function renderNotificationTemplate(context) {
    const { policy, violations = [], evidence = [], message } = context;
    let comment = '## MDP Policy Notification\n\n';
    // Custom message
    if (message) {
        comment += `${message}\n\n`;
    }
    // Policy info
    if (policy) {
        comment += `**Policy:** ${policy.title || policy.id}\n`;
        comment += `**Version:** ${policy.version}\n\n`;
    }
    // Violations
    if (violations.length > 0) {
        comment += '### Policy Results\n\n';
        violations.forEach((v) => {
            const severity = v.severity || 'info';
            const emoji = severity === 'error' ? ':x:' : severity === 'warning' ? ':warning:' : ':information_source:';
            comment += `${emoji} ${v.message || 'Policy result'}\n`;
            if (v.location?.file) {
                comment += `   - \`${v.location.file}\``;
                if (v.location.line) {
                    comment += `:${v.location.line}`;
                }
                comment += '\n';
            }
        });
        comment += '\n';
    }
    // Evidence
    if (evidence.length > 0) {
        comment += '### Evidence\n\n';
        evidence.forEach((e) => {
            comment += `- ${e}\n`;
        });
        comment += '\n';
    }
    // Footer
    comment += '---\n';
    comment += '*Generated by MDP Policy Engine*\n';
    return comment;
}
/**
 * Violation Template
 */
function renderViolationTemplate(context) {
    const { policy, violations = [], evidence = [] } = context;
    let comment = '## :x: MDP Policy Violation\n\n';
    // Policy info
    if (policy) {
        comment += `**Policy:** ${policy.title || policy.id}\n`;
        comment += `**Version:** ${policy.version}\n`;
        comment += `**Scope:** ${policy.scope}\n\n`;
        if (policy.description) {
            comment += `${policy.description}\n\n`;
        }
    }
    // Violations
    if (violations.length > 0) {
        comment += '### Violations\n\n';
        violations.forEach((v, i) => {
            comment += `${i + 1}. **${v.message || 'Policy violation'}**\n`;
            if (v.location?.file) {
                comment += `   - Location: \`${v.location.file}\``;
                if (v.location.line) {
                    comment += `:${v.location.line}`;
                    if (v.location.column) {
                        comment += `:${v.location.column}`;
                    }
                }
                comment += '\n';
            }
            if (v.severity) {
                comment += `   - Severity: ${v.severity}\n`;
            }
        });
        comment += '\n';
    }
    // Evidence
    if (evidence.length > 0) {
        comment += '### Evidence\n\n';
        evidence.forEach((e) => {
            comment += `- ${e}\n`;
        });
        comment += '\n';
    }
    // Next steps
    comment += '### Next Steps\n\n';
    comment += '1. Review the violations above\n';
    comment += '2. Make necessary changes to comply with policy\n';
    comment += '3. Push updates to re-trigger policy checks\n\n';
    // Footer
    comment += '---\n';
    comment += '*This PR is blocked by policy violations. ';
    comment += 'Please address the issues above before merging.*\n';
    return comment;
}
//# sourceMappingURL=index.js.map